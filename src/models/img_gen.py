import cv2
import numpy as np
import urllib.request
import openai

def url_to_image(url: str) -> np.ndarray:
    """
    Downloads an image from a given URL using urllib, and converts it to a numpy array for use with OpenCV.

    Args:
        url: A string representing URL of the image to be downloaded.

    Returns:
        A numpy array representing the downloaded image.

    """

    # Download the image using urllib.
    with urllib.request.urlopen(url) as url_response:
        img_array = bytearray(url_response.read())

    # Convert the byte array to a numpy array for use with OpenCV.
    img = cv2.imdecode(np.asarray(img_array), cv2.IMREAD_UNCHANGED)

    # Return the image as a numpy array.
    return img


def text_to_img(prompt: str) -> np.ndarray:
    """ Takes in a prompt and returns an image generated by OpenAI's Image API.
    
    Args:
    prompt : A string, the prompt that will be sent to the OpenAI API to generate the image.
    
    Returns:
    image : A numpy ndarray object, which represents the image generated corresponding to the input prompt.
    """
    # Create an image from prompt using OpenAI's API 
    response = openai.Image.create(prompt=prompt, n=1, size="1024x1024")
    
    # Get the url of the generated image and return it as a numpy array object.
    image_url = response["data"][0]["url"]
    image = url_to_image(image_url)

    return image
